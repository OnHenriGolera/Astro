<br>
<div align="center">
  <a href="https://github.com/othneildrew/Best-README-Template">
    <img src="../img/Logo.svg" alt="Logo" width="300" height="300">
  </a>

  <h3 align="center">Astro project</h3>

  <p align="center">
    Astro is an open-source, modern and intuitive competition manager.
  </p>
</div>

Astro is using a database to store all the data. So there is a need to think about the database structure and how to use it.

# What we need to store

Different kinds of data will be stored in the database. 

## Persons

A **Person** is a human being. It can be a referee, a participant, an organizer, etc.

We need to store the following data for each person:

- `Id` (unique)
- `Name`
- `Surname`

## Users

The site will be mostly read-only, but there will be some users that will be able to modify the data: organizers, jury members, and admins.

We need to store the following data for each user:

- `UserId` (unique)
- `Person` (see above)
- `Password` (hashed) - generated by an admin?
- `Role` (organizer, admin, referees) - to be able to check if the user has the right to modify the data

## Stages

A **Stage** is a part of the competition. It can be a qualification, a final, a semi-final, etc. It is part of a **Competition**.

We need to store the following data for each stage:

- `Id` (unique)
- `Formula Element` (see below)

## Competitions

A **Competition** is a set of stages, ordered by a **Formula**. 

We need to store the following data for each competition:

- `Id` (unique)
- `Name`
- `Formula` (see below)
- `Stages` (see above)
- `Participants` (see below)
- `Status` (`open`, `closed`, `running`, `finished`)
- `Category` (`FFU20`, ...)
  
## Formulas

A **Formula** is a way to order the stages of a competition. It is a sequence of **Formula elements**.

We need to store the following data for each formula:

- `Id` (unique)
- `Name`
- `Elements` (see below)

## Formula elements

A **Formula element** is a part of a **Formula**. It is an abstraction of a stage. 

We need to store the following data for each formula element:

- `Type` (`qualification`, `final`, `semi-final`, `quarter-final`, `pool`, `direct elimination`, ...)
- `Number of participants`
- `Number of participants that qualify for the next stage`

## Participants

A **Participant** is a **Person** that is participating in a **Competition**.

We need to store the following data for each participant:

- `ParticipantId` (unique)
- `Person` (see above)
- `Category` (`FFU20`, ...)
- `Present` (`true`, `false`)

# Database structure

With all those information, we can create a OOP structure :

<!-- <div align="center">
  <img src="./externals/database.svg" alt="Database structure" width="80%">
</div> -->


```plantuml
@startuml

class StageElement {
	- id : int
    - numberOfParticipants : int
    - numberOfParticipantsThatQualify : int
	- name : String
	- description : String
	- type : String
}

class Stage {
	- id : int
	- stageElement : StageElement
	- participants : List<Participant>
}

class Person {
	- id : int
	- name : String
	- surname : String
}

class Participant {
	- id : int
	- person : Person
	- category : String
	- present : boolean
}

class Formula {
	- id : int
	- name : String
	- stageElements : List<StageElement>
}

class Competition {
	- id : int
	- name : String
	- formula : Formula
	- stages : List<Stage>
	- participants : List<Participant>
	- status : String
	- category : String
}

StageElement <-- Stage : has a
Stage "0..*" --> "0..*" Participant : participants
Competition "0..*" --> "1" Stage : stages
Competition "0..1" --> "0..*" Formula : formula
Formula "1..1" --> "0..*" StageElement : components
Participant "0..1" --> "0..1" Person : person

@enduml
```

In the database, it will look like this:

<!-- <div align="center">
  <img src="./externals/database.png" alt="Database structure" width="80%">
</div> -->

```plantuml
@startuml


!define primary_key(name, type) <b><color:#b8861b><&key></color> <u>name</u> : <color:#e76f51><i>type</i></color></b>
!define foreign_key(name, type) <color:#aaaaaa><&key></color> name : <color:#e76f51><i>type</i></color>
!define column(name, type) <color:#efefef><&media-record></color> name : <color:#e76f51><i>type</i></color>
!define table(x) entity x << (T, white) >>

hide methods

table(StageElement) {
	primary_key(id, int)
	column(numberOfParticipants, int)
	column(numberOfParticipantsThatQualify, int)
	column(name, String)
	column(description, String)
	column(type, String)
}

table(Stage) {
	primary_key(id, int)
	foreign_key(stageElementId, int)
	column(name, String)
}

table(Person) {
	primary_key(id, int)
	column(name, String)
	column(surname, String)
}

table(Participant) {
	primary_key(id, int)
	foreign_key(personId, int)
	column(category, String)
	column(present, boolean)
}

table(Formula) {
	primary_key(id, int)
	column(name, String)
	column(description, String)
}

table(Competition) {
	primary_key(id, int)
	foreign_key(formulaId, int)
	column(name, String)
	column(status, String)
	column(category, String)
}

StageElement "0..*" <-- "0..1" Stage : has a
' Stage "0..*" --> "0..*" Participant : participants -> Has to be replaced by a table

table(StageParticipants) {
	primary_key(id, int)
	foreign_key(stageId, int)
	foreign_key(participantId, int)
}

Stage "0..*" <-- "0..1" StageParticipants
StageParticipants "0..*" --> "0..1" Participant


' Competition "0..*" --> "1" Stage : stages -> Has to be replaced by a table

table(CompetitionStages) {
	primary_key(id, int)
	foreign_key(competitionId, int)
	foreign_key(stageId, int)
}

Competition "0..*" <-- "0..1" CompetitionStages
CompetitionStages "0..*" --> "0..1" Stage
Competition "0..1" --> "0..*" Formula : formula 

' Formula "1..1" --> "0..*" StageElement : components -> Has to be replaced by a table

table(FormulaStageElements) {
	primary_key(id, int)
	foreign_key(formulaId, int)
	foreign_key(stageElementId, int)
}

Formula "1..1" <-- "0..1" FormulaStageElements
FormulaStageElements "0..*" --> "0..1" StageElement

Participant "0..1" --> "0..1" Person : person

@enduml
```